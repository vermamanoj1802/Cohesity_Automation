# Extend_Retention Subdirectory Overview
Warning:
These codes are provided on a best effort basis created for specific infra and is not in any way officially supported or sanctioned by Cohesity. The code in this repository are provided as-is and the author accepts no liability for damages resulting from its use.

This subdirectory, `cohesity-automation/Extend_Retention/`, contains automation scripts and playbooks related to extending the retention period for local backup copies stored within a Cohesity cluster.

## Contents

- **README_retention.md** â€“ Documentation for this subdirectory and its automation purpose.
- **Playbooks & Scripts** â€“ Ansible playbooks and supporting files for managing retention policies of Cohesity local backup copies.
     - changeLocalRetention.py -  **DO NOT EDIT This File.**
     - pyhesity.py -  **DO NOT EDIT This File.**

## Purpose

The contents in this directory are intended to automate the process of modifying or extending the retention of backups stored locally on the Cohesity cluster. This is typically required to ensure backups are kept longer than default periods, to meet compliance or business needs.

| Playbook                | Purpose                                                                                                               | Github Action Workflow to Use |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------|-----------------|
| `Extend_Local_Retention.yaml`   | Extend the retention of local copies (backup stored in cluster) all the Protection group jobs mentioned in `Protection_Group_list` file as per the selected option in the playbook. It will also send the outpu in .txt and .csv format on provided email ID | `Extend_Local_retention`



## ðŸ§© How to Increase Retention for Protection Groups

Follow these simple steps to safely increase the retention period for your Protection Groups.
##
## ðŸ“ Step 1: List the Protection Groups

  - Open the file `Protection_Group_list`.

  - Add the names of all Protection Groups for which you want to increase the retention.
##
## ðŸ§ª Step 2: Steps to Extend Local Retention

1. **Go to** the **Actions** menu and run the **`Extend_Local_retention`** workflow.

2. **Enter the required inputs** as mentioned below (default values are pre-filled; modify them as needed):


   - **Select the cluster to make changes:**
     select the correct cluster from dropdown list.

   - **Number of days for `-n` (only process snapshots newer than *n* days):**  
     Specify how many snapshots (counting from the latest) you want to extend the retention for.

   - **Extend retention by how many days:**  
     Specify the number of days (from the original backup date) the snapshots should be retained.

     **Example:**  
     If input is`15`, it means the retention will be extended by **15 days only and final retention is 29 days**,  
     since the original retention period is already **14 days** from the original backup date as per the policy.

   - **Recipient email address for receiving the test/actual run output (retention report):**  
     Enter your email address. Leave the default value to send the report to the entire team.

   - **Set to `true` to actually commit changes (adds `-x` flag):**  
     Perform a test run with the default value **`False`** before committing any changes.
     Select the option from dropdown list.
  


---

### Notes
- Always verify the retention settings before running the workflow in commit mode.
- Use test mode (`False`) to validate input parameters and review the email report prior to making permanent changes.

  ##

As per your requirement You can select options from below list. Add the additional parameters in `Extend_Local_Retention.yaml` before executing your workflow.
   ##
Authentication Parameters

    -v, --vip: DNS or IP of the Cohesity cluster to connect to
    
    -u, --username: username to authenticate to Cohesity cluster
    
    -d, --domain: (optional) domain of username (defaults to local)
    
    -i, --useApiKey: (optional) use API key for authentication
    
    -pwd, --password: (optional) password or API key
    
    -np, --noprompt: (optional) do not prompt for password
    
    -m, --mfacode: (optional) MFA code for authentication
    

Other Parameters

    -k, --keepfor: number of days (from original backup date) to retain the snapshots
    
    -t, --backupType: (optional) kLog, kRegular, kFull, kSystem (default is AllExceptLogs)
    
    -log, --includelogs: (optional) update retention for log backups (will skip logs by default)
    
    -a, --allowreduction: (optional) allow retention to be reduced
    
    -x, --commit: (optional) perform updates (otherwise just show what would happen)
    
    -n, --newerthan: (optional) only process snapshots newer than X days
    
    -o, --olderthan: (optional) only process snapshots olderthan than X days
    
    -g, --greaterthan: (optional) only process snapshots with existing retentions longer than X days
    
    -j, --jobname: (optional) one or more protection job names to include (default is all jobs)
    
    -l, --joblist: (optional) text file of job names to include (default is all jobs)
    
    -id, --runid: (optional) run ID to operate on
    
    -dt, --rundate: (optional) run date to operate on (e.g. '2024-01-03 23:30')
    
    -n, --numruns: (optional) runs per api querty (default is 1000)
    

   ##

> **Note:**  
> Always review and test automation scripts in a development environment before deploying to production.

